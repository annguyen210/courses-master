<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chatbot AI</title>
  </head>
  <body>
    <div class="chat-container">
      <h2>Trò chuyện với Chatbot ✅</h2>
      <div class="chat-box" id="chat-box">
        <div class="bot-message">Xin chào! Tôi có thể giúp gì cho bạn?</div>
      </div>
      <form id="chat-form">
        <input
          type="text"
          id="user-input"
          placeholder="Nhập câu hỏi của bạn..."
          autocomplete="off"
          required
        />
        <button type="submit">Gửi</button>
      </form>
    </div>
  <style>
    body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.chat-container {
  width: 400px;
  background: #A0C878;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

.chat-box {
  height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  margin-bottom: 10px;
  background: #fafafa; 
}

.user-message, .bot-message {
  margin: 10px 0;
  padding: 10px;
  border-radius: 10px;
  max-width: 80%;
}

.user-message {
  background: #d1e7dd;
  align-self: flex-end;
  text-align: right;
}

.bot-message {
  background: #e2e3e5;
  align-self: flex-start;
  text-align: left;
}

#chat-form {
  display: flex;
}

#user-input {
  flex: 1;
  padding: 10px;
  font-size: 16px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #0056b3;
}

  </style>
  
  <script >
  const chatBox = document.getElementById("chat-box");
      const chatForm = document.getElementById("chat-form");
      const userInput = document.getElementById("user-input");

      //
      const OPENAI_API_KEY =
        "sk-J3vEsFqZXfrV6UtUPCVTYYgfTzUdAr7lrqmhAxO3xDkGOLyL";
      const API_URL = "https://api.chatanywhere.tech/v1";

      chatForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;

        appendMessage("user", message);
        userInput.value = "";

        appendMessage("bot", "Đang trả lời...");

        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${OPENAI_API_KEY}`,
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: message }],
          }),
        });

        const data = await response.json();
        const botReply =
          data.choices?.[0]?.message?.content ||
          "Xin lỗi, tôi không thể trả lời.";

        // Xoá dòng "Đang trả lời..."
        removeLastBotMessage();
        appendMessage("bot", botReply);
      });

      function appendMessage(sender, text) {
        const msg = document.createElement("div");
        msg.classList.add(sender === "user" ? "user-message" : "bot-message");
        msg.textContent = text;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function removeLastBotMessage() {
        const messages = document.querySelectorAll(".bot-message");
        if (messages.length > 0) {
          messages[messages.length - 1].remove();
        }
      }

  </script>
</body>
</html>
